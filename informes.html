<!DOCTYPE html>
<html lang="es" class="index-protected">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    (function earlyIndexGuard() {
      const SESSION_KEY = 'laJamoneraSession';
      const raw = localStorage.getItem(SESSION_KEY);
      if (!raw) {
        window.location.replace('./login.html');
        return;
      }

      try {
        const session = JSON.parse(raw);
        if (Date.now() < Number(session.expiresAt)) {
          document.documentElement.classList.add('auth-ok');
          return;
        }
      } catch (error) {
      }

      localStorage.removeItem(SESSION_KEY);
      window.location.replace('./login.html');
    })();
  </script>
  <title>La Jamonera | Informes bromatol칩gicos</title>
  <meta name="description" content="Back Office privado de La Jamonera para gesti칩n interna.">
  <link rel="shortcut icon" href="./IMG/La Jamonera App.png" type="image/x-icon">
  <link rel="icon" type="image/webp" href="./IMG/La Jamonera Cerdito.webp">
  <link rel="apple-touch-icon" href="./IMG/La Jamonera App.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="La Jamonera">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Viga&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="./CSS/style.css">
</head>
<body>
  <main class="app-shell container-fluid px-0">
    <section id="appView" class="view view-app">
      <header class="topbar">
        <nav class="navbar navbar-expand-lg topbar-nav">
          <div class="container-fluid topbar-container">
            <a class="navbar-brand topbar-brand" href="./index.html" aria-label="Ir a inicio">
              <img src="./IMG/La Jamonera Cerdito.webp" alt="Logo La Jamonera" class="topbar-brand-logo">
              <span class="topbar-brand-text"><span class="brand-light">La</span> <span class="brand-bold">Jamonera</span></span>
            </a>

            <button class="navbar-toggler topbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topbarMenu" aria-controls="topbarMenu" aria-expanded="false" aria-label="Abrir men칰 de navegaci칩n">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="topbarMenu">
              <span class="barra-vertical"></span>
              <ul class="navbar-nav topbar-links me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a class="nav-link topbar-link" href="./index.html">Inicio</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link topbar-link active" href="./informes.html" aria-current="page">Informes bromatol칩gicos</a>
                </li>
              </ul>

              <div class="topbar-user dropdown">
                <button class="btn topbar-user-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Abrir men칰 de usuario">
                  <i class="fa-solid fa-circle-user"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-end topbar-user-menu">
                  <p class="topbar-user-name">Usuario: <strong>La Jamonera</strong></p>
                  <button class="btn ios-btn ios-btn-secondary w-100 js-logout" type="button">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span>Cerrar sesi칩n</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </header>

      <div class="contenido">
        <div class="header-content">
          <div class="home-actions-scroll" aria-label="Acciones disponibles">
            <button
              id="openInformesModal"
              type="button"
              class="btn btn-light home-action-btn"
              data-bs-toggle="modal"
              data-bs-target="#informesModal"
            >
              <i class="fa-solid fa-file-lines icon-green" aria-hidden="true"></i>
              <span>Nuevo informe</span>
            </button>
            <button id="openFilterInformesBtn" type="button" class="btn btn-light home-action-btn">
              <i class="fa-solid fa-filter icon-green" aria-hidden="true"></i>
              <span>Filtrar informes</span>
            </button>
            <button id="clearFilterInformesBtn" type="button" class="btn btn-light home-action-btn d-none">
              <i class="fa-solid fa-rotate-left icon-green" aria-hidden="true"></i>
              <span>Volver atr치s</span>
            </button>
            <input id="informesFilterInput" type="text" class="d-none" aria-label="Filtro por fecha">
          </div>
        </div>
        <div class="home-content informes-home-content">
          <div id="informesBoardLoading" class="informes-board-loading" aria-live="polite">
            <img src="./IMG/Meta-ai-logo.webp" alt="Cargando informes" class="meta-spinner-login informes-board-spinner">
          </div>
          <div id="informesBoardEmpty" class="informes-board-empty d-none">No hay informes para cargar</div>
          <div id="informesCardsGrid" class="informes-cards-grid d-none"></div>
          <div id="informesPagination" class="informes-pagination d-none"></div>
        </div>
      </div>

      <div class="modal fade" id="informesModal" tabindex="-1" aria-labelledby="informesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content ios-modal informes-modal">
            <div class="modal-header ios-modal-header">
              <h5 class="modal-title ios-modal-title" id="informesModalLabel">Nuevo informe bromatol칩gico</h5>
              <button type="button" class="btn-close ios-modal-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body ios-modal-body">
              <div id="informesLoading" class="informes-loading" aria-live="polite">
                <img src="./IMG/Meta-ai-logo.webp" alt="Cargando informes" class="meta-spinner-login">
              </div>

              <div id="informesData" class="informes-data d-none" aria-live="polite">
                <div class="informes-toolbar">
                  <button id="openUserFormBtn" type="button" class="btn ios-btn ios-btn-success">
                    <i class="fa-solid fa-user-plus"></i>
                    <span>Crear usuario</span>
                  </button>
                </div>

                <div id="informesUsersList" class="informes-users-list"></div>

                <div class="informe-meta-grid">
                  <div>
                    <label class="form-label" for="informeDateInput">Fecha del informe</label>
                    <input id="informeDateInput" type="text" class="form-control ios-input" placeholder="Seleccionar fecha">
                  </div>
                  <div>
                    <label class="form-label" for="informeUserSelect">Usuario para guardar</label>
                    <select id="informeUserSelect" class="form-select ios-input"></select>
                  </div>
                </div>

                <div class="editor-wrap">
                  <div class="editor-toolbar-scroll">
                    <div class="editor-toolbar" role="toolbar" aria-label="Herramientas de edici칩n">
                    <button type="button" class="editor-btn" data-cmd="bold" title="Negrita"><i class="fa-solid fa-bold"></i></button>
                    <button type="button" class="editor-btn" data-cmd="italic" title="Cursiva"><i class="fa-solid fa-italic"></i></button>
                    <button type="button" class="editor-btn" data-cmd="underline" title="Subrayado"><i class="fa-solid fa-underline"></i></button>
                    <button type="button" class="editor-btn" data-cmd="strikeThrough" title="Tachado"><i class="fa-solid fa-strikethrough"></i></button>

                    <select id="formatBlockSelect" class="editor-select" aria-label="Tipo de texto">
                      <option value="P">Normal</option>
                      <option value="H3">T칤tulo</option>
                      <option value="H4">Subt칤tulo</option>
                      <option value="BLOCKQUOTE">Cita</option>
                    </select>

                    <select id="fontSizeSelect" class="editor-select">
                      <option value="3">Normal</option>
                      <option value="2">Peque침o</option>
                      <option value="4">Grande</option>
                      <option value="5">Muy grande</option>
                    </select>

                    <label class="editor-color-wrap" title="Color de texto">
                      <i class="fa-solid fa-font"></i>
                      <input id="textColorInput" type="color" class="editor-color-input" value="#000000" aria-label="Color de texto">
                    </label>
                    <label class="editor-color-wrap" title="Color de resaltado">
                      <i class="fa-solid fa-highlighter"></i>
                      <input id="highlightColorInput" type="color" class="editor-color-input" value="#ffffff" aria-label="Color de resaltado">
                    </label>
                    <button type="button" class="editor-btn" id="applyHighlightBtn" title="Aplicar resaltado"><i class="fa-solid fa-highlighter"></i></button>
                    <button type="button" class="editor-btn" data-cmd="removeFormat" title="Quitar formato"><i class="fa-solid fa-eraser"></i></button>
                    <button type="button" class="editor-btn" data-cmd="insertUnorderedList" title="Lista con vi침etas"><i class="fa-solid fa-list-ul"></i></button>
                    <button type="button" class="editor-btn" data-cmd="insertOrderedList" title="Lista numerada"><i class="fa-solid fa-list-ol"></i></button>
                    <button type="button" class="editor-btn" data-cmd="justifyLeft" title="Alinear a izquierda"><i class="fa-solid fa-align-left"></i></button>
                    <button type="button" class="editor-btn" data-cmd="justifyCenter" title="Alinear al centro"><i class="fa-solid fa-align-center"></i></button>
                    <button type="button" class="editor-btn" data-cmd="justifyRight" title="Alinear a derecha"><i class="fa-solid fa-align-right"></i></button>
                    <button type="button" class="editor-btn" data-cmd="justifyFull" title="Justificar"><i class="fa-solid fa-align-justify"></i></button>

                    <div class="emoji-picker-wrap">
                      <button type="button" class="editor-btn" id="toggleEmojiPanel" title="Insertar emoji"><i class="fa-regular fa-face-smile"></i></button>
                      <div id="emojiPanel" class="emoji-panel" aria-label="Selector de emojis"></div>
                    </div>
                    </div>
                  </div>
                  <div id="informeEditor" class="informe-editor" contenteditable="true" aria-label="Editor de texto enriquecido" data-placeholder="Escrib칤 el informe ac치..."></div>
                </div>

                <div class="editor-preview-wrap">
                  <h6 class="editor-preview-title">Texto vista previa</h6>
                  <div id="informePreview" class="informe-preview">Texto vista previa</div>
                </div>

                <div class="importance-wrap">
                  <label class="form-label" for="importanceRange">Importancia sanitaria</label>
                  <input id="importanceRange" type="range" min="0" max="100" value="50" class="importance-range">
                  <div id="importanceLabel" class="importance-label">Normal 游땛</div>
                </div>

                <div class="attachments-wrap">
                  <div class="d-flex flex-wrap gap-2 align-items-center">
                    <button id="attachFilesBtn" type="button" class="btn ios-btn ios-btn-primary">
                      <i class="fa-solid fa-paperclip"></i>
                      <span>Adjuntar documentos e im치genes</span>
                    </button>
                    <input id="attachmentsInput" type="file" class="d-none" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.csv,.txt">
                  </div>
                  <div id="attachmentsGrid" class="attachments-grid"></div>
                </div>

                <div class="d-flex justify-content-end gap-2 mt-3">
                  <button id="clearInformeBtn" type="button" class="btn ios-btn ios-btn-secondary">
                    <i class="fa-solid fa-eraser"></i>
                    <span>Borrar todo el informe</span>
                  </button>
                  <button id="saveInformeBtn" type="button" class="btn ios-btn ios-btn-success">
                    <i class="fa-solid fa-floppy-disk"></i>
                    <span>Guardar informe</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="imageViewerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
          <div class="modal-content ios-modal image-viewer-modal">
            <div class="modal-header ios-modal-header">
              <h5 class="modal-title ios-modal-title">Vista de imagen</h5>
              <button type="button" class="btn-close ios-modal-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body ios-modal-body">
              <div class="image-viewer-controls">
                <button id="viewerPrevBtn" type="button" class="btn ios-btn ios-btn-secondary"><i class="fa-solid fa-chevron-left"></i></button>
                <button id="viewerZoomOutBtn" type="button" class="btn ios-btn ios-btn-secondary"><i class="fa-solid fa-magnifying-glass-minus"></i></button>
                <button id="viewerZoomInBtn" type="button" class="btn ios-btn ios-btn-secondary"><i class="fa-solid fa-magnifying-glass-plus"></i></button>
                <button id="viewerNextBtn" type="button" class="btn ios-btn ios-btn-secondary"><i class="fa-solid fa-chevron-right"></i></button>
              </div>
              <div id="viewerStage" class="viewer-stage">
                <img id="viewerImage" src="" alt="Imagen adjunta">
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="app-footer app-footer-white">
        <div class="footer-main">
          <div class="footer-brand-block">
            <img src="./IMG/La Jamonera Cerdito.webp" alt="Logo La Jamonera" class="footer-brand-logo">
            <div>
              <h3 class="footer-brand-title">La Jamonera</h3>
              <p class="footer-brand-text">Back Office</p>
            </div>
          </div>

          <div class="footer-actions">
            <button class="btn ios-btn ios-btn-secondary js-logout" type="button">
              <i class="fa-solid fa-right-from-bracket"></i>
              <span>Cerrar sesi칩n</span>
              <span id="sessionCountdown" class="session-countdown" aria-live="polite">--h --m</span>
            </button>

            <a class="support-link footer-support" href="https://wa.me/543416292861?text=Nos%20contactamos%20de%20Frigorifico%20la%20Jamonera%20desde%20el%20back%20office." target="_blank" rel="noopener noreferrer">
              <img src="./IMG/WhatsApp Logo.webp" alt="Soporte" class="support-icon">
              <span>Contactar soporte</span>
            </a>
          </div>
        </div>

        <div class="footer-divider" aria-hidden="true"></div>

        <p class="footer-legal">
          El uso de este sitio web implica la aceptaci칩n de los t칠rminos, condiciones y pol칤ticas de privacidad de
          <a href="https://asesoriabromatologicaros.com.ar/index.html" target="_blank" rel="noopener noreferrer">Asesoria Bromatologica Rosario</a>.
          Las imagenes son a modo ilustrativo.
        </p>

        <p class="footer-copy">
          춸 Copyright <span id="currentYear"></span> - Back Office para empresas, powered by
          <a href="https://asesoriabromatologicaros.com.ar/index.html" target="_blank" rel="noopener noreferrer">ABR</a>
          - Author: Ponzoni Lucas
          <a class="footer-mail" href="mailto:pablomanuelscalise@gmail.com" target="_blank" rel="noopener noreferrer" aria-label="Enviar email">
            <i class="fa-regular fa-envelope"></i>
          </a>
        </p>
      </footer>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
  <script src="./JS/firebase-init.js"></script>
  <script src="./JS/app.js"></script>
  <script src="./JS/Informes.js"></script>
</body>
</html>
